(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     35516,        932]
NotebookOptionsPosition[     33234,        871]
NotebookOutlinePosition[     33645,        889]
CellTagsIndexPosition[     33602,        886]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[TextData[{
 "\nCombining Howard equations and the quadratic nature of value function of \
states in multiclass m/m/1-PS (Leino et al.),\nthe number of linear equations \
reduces to K ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"+", " ", 
     FractionBox[
      RowBox[{"K", "(", 
       RowBox[{"K", "-", "1"}], ")"}], "2"]}], " ", "+", " ", "K"}], 
   TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "2649f56b-b871-4467-abb7-e933f830ceea"],
 ", i.e., ",
 Cell[BoxData[
  FormBox[
   RowBox[{"O", "(", 
    SuperscriptBox["K", "2"]}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "4a87f0d8-76d0-4179-b5df-4fbab424f02a"],
 ")"
}], "Text",
 CellChangeTimes->{{3.716023110104619*^9, 3.716023381301321*^9}, {
  3.716023971365889*^9, 3.716023972517726*^9}, {3.716029257872757*^9, 
  3.7160292683830833`*^9}},ExpressionUUID->"17bf2c7d-9fb8-44a6-87af-\
8a6134826c47"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"coefficients", "[", "numClasses_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", "i", ",", "j", ",", "arow"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", " ", 
         RowBox[{"i", "\[LessEqual]", "numClasses"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"arow", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", "numClasses"}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[GreaterEqual]", "j"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"arow", ",", 
                RowBox[{"Symbol", "[", 
                 RowBox[{"\"\<a\>\"", "<>", 
                  RowBox[{"ToString", "[", "i", "]"}], "<>", 
                  RowBox[{"ToString", "[", "j", "]"}]}], "]"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"arow", ",", 
                RowBox[{"Symbol", "[", 
                 RowBox[{"\"\<a\>\"", "<>", 
                  RowBox[{"ToString", "[", "j", "]"}], "<>", 
                  RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"a", ",", " ", "arow"}], "]"}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "a"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.716024616211174*^9, 3.7160246405701313`*^9}, {
   3.7160251987971773`*^9, 3.716025284349873*^9}, {3.7160254141792088`*^9, 
   3.7160254631092033`*^9}, {3.716025597609393*^9, 3.716025626425117*^9}, {
   3.716025689305264*^9, 3.716025694074237*^9}, {3.71602574014187*^9, 
   3.716025776637224*^9}, {3.716025910180739*^9, 3.716025994873652*^9}, {
   3.716026028262525*^9, 3.716026034632938*^9}, {3.7160261932916403`*^9, 
   3.716026295789319*^9}, {3.716026327948625*^9, 3.716026555044425*^9}, {
   3.716026637079072*^9, 3.716026637607843*^9}, {3.716026817598378*^9, 
   3.71602682034931*^9}, {3.716027017460964*^9, 3.7160270251877337`*^9}, {
   3.716032032342107*^9, 3.7160320518763323`*^9}, 3.716097888371828*^9, 
   3.7161128839989777`*^9},ExpressionUUID->"bac99482-c875-4b5d-9494-\
2bd0b0e0ff7f"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"linearEquations", "[", 
    RowBox[{"arrRates_", ",", " ", "servRates_", ",", " ", "numClasses_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j", ",", "k", ",", "equations", ",", "a"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"equations", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"coefficients", "[", "numClasses", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"**", "generate"}], " ", "K", " ", "equations"}], ",", " ", 
        RowBox[{"K", "=", "numClasses"}]}], "***)"}], "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "numClasses"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"equations", ",", " ", 
          RowBox[{"1", " ", "+", " ", 
           RowBox[{"2", " ", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"arrRates", "[", 
                RowBox[{"[", "j", "]"}], "]"}], " ", 
               RowBox[{"a", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", " ", "i"}], "]"}], "]"}]}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", "numClasses"}], "}"}]}], "]"}]}], 
           " ", "-", 
           RowBox[{"2", " ", 
            RowBox[{"a", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "i"}], "]"}], "]"}], " ", 
            RowBox[{"servRates", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}]}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"**", "generate"}], " ", "K", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"K", "-", "1"}], ")"}], "/", "2"}], " ", "equations"}], 
        ",", " ", 
        RowBox[{"K", "=", "numClasses"}]}], "***)"}], "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"numClasses", "-", "1"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", 
            RowBox[{"i", "+", "1"}]}], ",", " ", 
           RowBox[{"j", "\[LessEqual]", "numClasses"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"equations", ",", " ", 
              RowBox[{"1", " ", "+", " ", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"arrRates", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", " ", "i"}], "]"}], "]"}], "+", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "j"}], "]"}], "]"}]}], ")"}]}], ",", 
                 " ", 
                 RowBox[{"{", 
                  RowBox[{"k", ",", "1", ",", "numClasses"}], "}"}]}], "]"}], 
               " ", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"a", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", 
                 RowBox[{"servRates", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"servRates", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], " ", 
                 RowBox[{"a", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "i"}], "]"}], "]"}]}], ")"}]}]}], "]"}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"**", "generate"}], " ", "K", " ", "equations"}], ",", " ", 
        RowBox[{"K", "=", "numClasses"}]}], "***)"}], "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "numClasses"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"equations", ",", " ", 
          RowBox[{
           RowBox[{"servRates", "[", 
            RowBox[{"[", "i", "]"}], "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Symbol", "[", 
              RowBox[{"\"\<a\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "-", 
             RowBox[{"a", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "i"}], "]"}], "]"}]}], ")"}]}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "equations"}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.716027733206336*^9, 3.7160280034554443`*^9}, 
   3.716028775490158*^9, {3.716028865219819*^9, 3.7160288928043137`*^9}, {
   3.716028933893358*^9, 3.7160290538348494`*^9}, {3.716029429254259*^9, 
   3.716029574377687*^9}, {3.716029658796275*^9, 3.7160297403346853`*^9}, {
   3.7160297773141413`*^9, 3.716029842578601*^9}, {3.716029891748752*^9, 
   3.716029973686709*^9}, {3.716032134585272*^9, 3.716032159705655*^9}, 
   3.7160978883799334`*^9, 3.716097949127681*^9, 3.716100202669327*^9, {
   3.716100434054929*^9, 3.71610044959096*^9}, 
   3.716100524394227*^9},ExpressionUUID->"609d29f7-0a0b-4f89-9d8a-\
cb6591f401a9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"solveEquation", "[", 
     RowBox[{"arrRates_", ",", "servRates_", ",", " ", "numClasses_"}], "]"}],
     ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"equations", " ", "=", " ", 
        RowBox[{"linearEquations", "[", 
         RowBox[{"arrRates", ",", "servRates", ",", "numClasses"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"zeros", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "equations", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"coefficients", "[", "numClasses", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ai", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Symbol", "[", 
           RowBox[{"\"\<a\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "numClasses"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"variables", ",", " ", "ai"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Flatten", "[", "variables", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"solution", " ", "=", " ", 
        RowBox[{"Solve", "[", 
         RowBox[{
          RowBox[{"equations", " ", "\[Equal]", " ", "zeros"}], ",", " ", 
          RowBox[{"DeleteDuplicates", "[", "variables", "]"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"solution", ",", " ", "variables"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"sol", " ", "=", " ", 
    RowBox[{"solveEquation", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"3", ",", "4"}], "}"}], ",", "2"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.716032377421318*^9, 3.716032558820561*^9}, {
   3.716032732505889*^9, 3.716032987314087*^9}, {3.716033128040325*^9, 
   3.716033129302466*^9}, {3.716033203625462*^9, 3.716033217943671*^9}, {
   3.716033265626913*^9, 3.716033266856365*^9}, {3.716054240060499*^9, 
   3.7160542481983213`*^9}, {3.7160550302576733`*^9, 3.716055036702992*^9}, {
   3.7160550908509417`*^9, 3.716055097992983*^9}, 3.716097888390964*^9, 
   3.716097949122661*^9, {3.7161010639523487`*^9, 
   3.716101072481275*^9}},ExpressionUUID->"3b92c66c-7331-45bb-9f6e-\
cabb8f248a09"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a11", "\[Rule]", 
       FractionBox["9", "8"]}], ",", 
      RowBox[{"a21", "\[Rule]", 
       FractionBox["7", "8"]}], ",", 
      RowBox[{"a22", "\[Rule]", 
       FractionBox["11", "16"]}], ",", 
      RowBox[{"a1", "\[Rule]", 
       FractionBox["9", "8"]}], ",", 
      RowBox[{"a2", "\[Rule]", 
       FractionBox["11", "16"]}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"a11", ",", "a21", ",", "a21", ",", "a22", ",", "a1", ",", "a2"}],
     "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.716032988476536*^9, 3.716033130230751*^9, {3.716033218914258*^9, 
   3.7160332673785677`*^9}, 3.716054252499889*^9, 3.716055037925354*^9, 
   3.7160550990370407`*^9, 3.716097990575461*^9, 3.716100531362526*^9, {
   3.716101073681036*^9, 
   3.716101093190637*^9}},ExpressionUUID->"e4468b5b-b237-485a-aa19-\
934998878c6a"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"valueFunction", "[", 
    RowBox[{
    "state_", ",", " ", "arrRates_", ",", "servRates_", ",", " ", 
     "numClasses_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", "j", ",", "solset", ",", "solution", ",", "variables", ",", 
       "coefs", ",", "amatrix", ",", "avec", ",", "value"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"solset", "=", 
       RowBox[{"solveEquation", "[", 
        RowBox[{"arrRates", ",", "servRates", ",", "numClasses"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"solution", "=", 
       RowBox[{"solset", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"variables", "=", 
       RowBox[{"solset", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coefs", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"Replace", "[", 
           RowBox[{
            RowBox[{"variables", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "solution"}], "]"}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "variables", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"amatrix", " ", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{"coefs", ",", " ", 
           RowBox[{"numClasses", "*", "numClasses"}]}], "]"}], ",", 
         "numClasses"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"avec", "=", 
       RowBox[{"Take", "[", 
        RowBox[{"coefs", ",", 
         RowBox[{"-", "numClasses"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"value", "=", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"amatrix", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], 
             RowBox[{"state", "[", 
              RowBox[{"[", "i", "]"}], "]"}], 
             RowBox[{"state", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "numClasses"}], "}"}]}], "]"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "numClasses"}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", "+", " ", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"avec", "[", 
            RowBox[{"[", "i", "]"}], "]"}], 
           RowBox[{"state", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "numClasses"}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", "value"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7160568945057592`*^9, 3.716057075896921*^9}, {
  3.7160571105142097`*^9, 3.7160571266429653`*^9}, {3.716060799692829*^9, 
  3.716060920618514*^9}, {3.716060962410295*^9, 3.7160609927596693`*^9}, {
  3.7160610616979437`*^9, 3.716061065007469*^9}, {3.716061096826653*^9, 
  3.716061363614417*^9}},ExpressionUUID->"0e3fbda1-d99c-4dcd-a92c-\
41db55fa56c9"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.716056781676092*^9},ExpressionUUID->"abcf8633-044c-4038-adc4-\
01dc171479fd"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"solveEquation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"2", ",", "3", ",", "4"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"5", ",", "6", ",", "7"}], "}"}], ",", "3"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.716101215349069*^9, 3.716101219175164*^9}, 
   3.716101268394711*^9},ExpressionUUID->"a5eba7c4-4e30-4e9d-ba9d-\
6f18207e2324"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a11", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["409", "1188"]}]}], ",", 
      RowBox[{"a21", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["295", "1188"]}]}], ",", 
      RowBox[{"a31", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["13", "66"]}]}], ",", 
      RowBox[{"a22", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["50", "297"]}]}], ",", 
      RowBox[{"a32", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["151", "1188"]}]}], ",", 
      RowBox[{"a33", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["109", "1188"]}]}], ",", 
      RowBox[{"a1", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["409", "1188"]}]}], ",", 
      RowBox[{"a2", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["50", "297"]}]}], ",", 
      RowBox[{"a3", "\[Rule]", 
       RowBox[{"-", 
        FractionBox["109", "1188"]}]}]}], "}"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "a11", ",", "a21", ",", "a31", ",", "a21", ",", "a22", ",", "a32", ",", 
     "a31", ",", "a32", ",", "a33", ",", "a1", ",", "a2", ",", "a3"}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.716101269743505*^9},ExpressionUUID->"80d0818f-f0a8-432d-bab2-\
a1ca11444f86"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"valueFunction", "[", "xvec_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        SubscriptBox["a", 
         RowBox[{"i", ",", "i"}]], " ", 
        SuperscriptBox[
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xvec", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ")"}], " "}], "2"]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], "]"}], "+", " ", 
     RowBox[{"2", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["a", 
            RowBox[{"i", ",", "j"}]], " ", 
           RowBox[{"xvec", "[", 
            RowBox[{"[", "i", "]"}], "]"}], " ", 
           RowBox[{"xvec", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"i", "+", "1"}], ",", 
            RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "[", "xvec", "]"}], "-", "1"}]}], "}"}]}], 
       "]"}]}], "+", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        SubscriptBox["a", "i"], " ", 
        RowBox[{"xvec", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], " ", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"avgCostRate", "[", 
     RowBox[{"arrRates_", ",", "servRates_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       FractionBox[
        RowBox[{"arrRates", "[", 
         RowBox[{"[", "i", "]"}], "]"}], 
        RowBox[{"servRates", "[", 
         RowBox[{"[", "i", "]"}], "]"}]], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "arrRates", "]"}]}], "}"}]}], "]"}], "/", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"Sum", "[", 
        RowBox[{
         FractionBox[
          RowBox[{"arrRates", "[", 
           RowBox[{"[", "i", "]"}], "]"}], 
          RowBox[{"servRates", "[", 
           RowBox[{"[", "i", "]"}], "]"}]], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "arrRates", "]"}]}], "}"}]}], "]"}]}], 
      ")"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"howardEquation", "[", 
     RowBox[{"xvec_", ",", "arrRates_", ",", "servRates_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"Sum", "[", " ", 
       RowBox[{
        RowBox[{"xvec", "[", 
         RowBox[{"[", "i", "]"}], "]"}], " ", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], "]"}], "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sum", "[", " ", 
         RowBox[{
          RowBox[{"xvec", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], "]"}], "-", 
        RowBox[{"avgCostRate", "[", 
         RowBox[{"arrRates", ",", "servRates"}], "]"}], " ", "+", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"arrRates", "[", 
            RowBox[{"[", "i", "]"}], "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"valueFunction", "[", 
              RowBox[{"xvec", "+", 
               RowBox[{"UnitVector", "[", 
                RowBox[{
                 RowBox[{"Length", "[", "xvec", "]"}], ",", "i"}], "]"}]}], 
              "]"}], "-", 
             RowBox[{"valueFunction", "[", "xvec", "]"}]}], ")"}]}], " ", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], "]"}]}], ")"}]}],
      "+", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"servRates", "[", 
         RowBox[{"[", "i", "]"}], "]"}], 
        RowBox[{"xvec", "[", 
         RowBox[{"[", "i", "]"}], "]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"valueFunction", "[", 
           RowBox[{"xvec", "-", 
            RowBox[{"UnitVector", "[", 
             RowBox[{
              RowBox[{"Length", "[", "xvec", "]"}], ",", "i"}], "]"}]}], 
           "]"}], "-", 
          RowBox[{"valueFunction", "[", "xvec", "]"}]}], ")"}]}], " ", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "xvec", "]"}]}], "}"}]}], 
      "]"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.716113957119132*^9, 3.716113957682287*^9}, {
  3.716114018806013*^9, 3.716114246588171*^9}, {3.716114337362114*^9, 
  3.716114341312581*^9}, {3.716114571114688*^9, 3.71611457378479*^9}, {
  3.7161148357794743`*^9, 3.716114993066371*^9}, {3.716115104651518*^9, 
  3.7161151223641853`*^9}, {3.716147354254362*^9, 3.7161474375111837`*^9}, {
  3.7161476356869917`*^9, 3.716147646418583*^9}, {3.71614795868438*^9, 
  3.7161479707599487`*^9}, {3.716176797347261*^9, 3.716176801681538*^9}, {
  3.716176842852256*^9, 3.716176845044485*^9}, {3.716176959239407*^9, 
  3.716176963606996*^9}, {3.7161770146347647`*^9, 
  3.7161770193684883`*^9}},ExpressionUUID->"f87970ff-fed9-4044-8315-\
7dbc78d2bc45"],

Cell[BoxData[
 RowBox[{
  RowBox[{"solveCoefficients", "[", 
   RowBox[{"arrRates_", ",", "servRates_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xvec", ",", "x", ",", "poly", ",", "eqn", ",", "soln", ",", "i"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xvec", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        SubscriptBox["x", "i"], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "arrRates", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"poly", " ", "=", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "*", "xvec"}], "&"}], "/@", "xvec"}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eqn", "=", 
      RowBox[{"Collect", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"howardEquation", "[", 
          RowBox[{"xvec", ",", "arrRates", ",", "servRates"}], "]"}], "//", 
         "Expand"}], ",", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Flatten", "[", "poly", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"soln", " ", "=", " ", 
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Coefficient", "[", 
             RowBox[{"eqn", ",", "#"}], "]"}], "\[Equal]", "0"}], ")"}], 
          "&"}], "/@", "poly"}], ",", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["a", 
            RowBox[{"i", ",", "j"}]], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "arrRates", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "i", ",", 
             RowBox[{"Length", "[", "arrRates", "]"}]}], "}"}]}], "]"}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"soln", "=", 
      RowBox[{"soln", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", "3"}], ",", 
       RowBox[{"i", "++"}], ",", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"soln", ",", " ", 
         RowBox[{
          SubscriptBox["a", "i"], "\[Rule]", 
          RowBox[{"Replace", "[", 
           RowBox[{
            SubscriptBox["a", 
             RowBox[{"i", ",", "i"}]], ",", "soln"}], "]"}]}]}], "]"}]}], 
      "]"}], ";", "\[IndentingNewLine]", "soln"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7161447922060347`*^9, 3.7161448496240396`*^9}, {
   3.716144881140667*^9, 3.7161449057688427`*^9}, {3.7161449586181183`*^9, 
   3.7161450204227667`*^9}, {3.71614507974296*^9, 3.716145087488168*^9}, {
   3.716145162594407*^9, 3.716145163136888*^9}, {3.716146746292265*^9, 
   3.716146788738043*^9}, {3.716146849624607*^9, 3.716146907778385*^9}, {
   3.716147010841384*^9, 3.716147053694768*^9}, {3.716179522891652*^9, 
   3.716179573579138*^9}, {3.716179657198081*^9, 3.7161796639022217`*^9}, {
   3.716179708242062*^9, 3.716179812099325*^9}, {3.7161798734133043`*^9, 
   3.716179921174654*^9}, {3.716179966936899*^9, 3.716179979101344*^9}, {
   3.716180013980575*^9, 3.716180066251609*^9}, {3.716180119199704*^9, 
   3.7161801857083282`*^9}, {3.71618029534725*^9, 3.716180319284381*^9}, {
   3.716180354133071*^9, 3.716180381798459*^9}, {3.7161804593548727`*^9, 
   3.716180479881692*^9}, {3.7161806502713614`*^9, 3.716180652991337*^9}, {
   3.716180769299982*^9, 3.7161807703382196`*^9}, 3.7161808194605513`*^9, {
   3.7161809249699697`*^9, 3.716180960872707*^9}, {3.716181057885277*^9, 
   3.7161810692283278`*^9}, {3.716181288948752*^9, 3.716181297955674*^9}, {
   3.716181387110588*^9, 3.716181399110712*^9}, {3.71618146927463*^9, 
   3.716181508346406*^9}, {3.716181739650997*^9, 3.716181771171432*^9}, {
   3.716181825322751*^9, 
   3.716181825798245*^9}},ExpressionUUID->"268631f2-689b-4f0f-af2e-\
4e01db36ec74"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"soln", "=", 
   RowBox[{"solveCoefficients", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.2", ",", "0.1", ",", "0.15"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1.", ",", "1.1", ",", "1.3"}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.716180407402117*^9, 3.716180427114007*^9}, {
  3.716180727330345*^9, 3.71618075833733*^9}, {3.716181174416626*^9, 
  3.716181177166685*^9}},ExpressionUUID->"4cf51ded-f54e-41c5-a51b-\
999d65bfa352"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"1", ",", "1"}]], "\[Rule]", "0.8625637232234772`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"1", ",", "2"}]], "\[Rule]", "0.8116636602640976`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"1", ",", "3"}]], "\[Rule]", "0.7258974170158141`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"2", ",", "2"}]], "\[Rule]", "0.765390875755571`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"2", ",", "3"}]], "\[Rule]", "0.6870542913516764`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"3", ",", "3"}]], "\[Rule]", "0.6207694891637656`"}], ",", 
   RowBox[{
    SubscriptBox["a", "1"], "\[Rule]", "0.8625637232234772`"}], ",", 
   RowBox[{
    SubscriptBox["a", "2"], "\[Rule]", "0.765390875755571`"}], ",", 
   RowBox[{
    SubscriptBox["a", "3"], "\[Rule]", "0.6207694891637656`"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.71618042840302*^9, 3.716180487810161*^9, 3.7161806567473*^9, {
   3.7161807599469833`*^9, 3.716180778819975*^9}, 3.716180826792528*^9, 
   3.716180967464452*^9, 3.716181076360744*^9, 3.7161811801250343`*^9, {
   3.716181492363616*^9, 3.7161815125666122`*^9}, 3.716181777631586*^9, 
   3.71618183107589*^9},ExpressionUUID->"ce525556-a587-4c65-98d0-\
2c179a211e44"]
}, Open  ]],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{{3.716181551468831*^9, 3.716181581211733*^9}, {
   3.716181613693796*^9, 3.7161816989598913`*^9}, 
   3.716181737139861*^9},ExpressionUUID->"b9cc74b1-3903-4a1b-b1bb-\
a5f943eba8e0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "soln"}]], "Input",
 CellChangeTimes->{{3.716181710226392*^9, 
  3.7161817134878187`*^9}},ExpressionUUID->"a2b86ce6-ec0b-4e69-8037-\
97c65c7b1c6d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"1", ",", "1"}]], "\[Rule]", "0.8625637232234772`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"1", ",", "2"}]], "\[Rule]", "0.8116636602640976`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"1", ",", "3"}]], "\[Rule]", "0.7258974170158141`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"2", ",", "2"}]], "\[Rule]", "0.765390875755571`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"2", ",", "3"}]], "\[Rule]", "0.6870542913516764`"}], ",", 
   RowBox[{
    SubscriptBox["a", 
     RowBox[{"3", ",", "3"}]], "\[Rule]", "0.6207694891637656`"}], ",", 
   RowBox[{
    SubscriptBox["a", "1"], "\[Rule]", "0.8625637232234772`"}], ",", 
   RowBox[{
    SubscriptBox["a", "2"], "\[Rule]", "0.765390875755571`"}], ",", 
   RowBox[{
    SubscriptBox["a", "3"], "\[Rule]", "0.6207694891637656`"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.716181714308728*^9},ExpressionUUID->"0268bf0d-a4e2-44f4-8858-\
99e980a94d43"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"valueFunction", "[", 
    RowBox[{"{", 
     RowBox[{"2", ",", "2", ",", "2"}], "}"}], "]"}], "/.", 
   "soln"}]}]], "Input",
 CellChangeTimes->{{3.7161810025249033`*^9, 3.71618103625072*^9}, {
   3.71618120468826*^9, 3.7161812393927917`*^9}, 
   3.7161818497182198`*^9},ExpressionUUID->"3271b799-feaf-47de-90a3-\
ef7e8f911dfd"],

Cell[BoxData["31.28926747790959`"], "Output",
 CellChangeTimes->{3.716181036853897*^9, 3.716181241137836*^9, 
  3.716181850629703*^9},ExpressionUUID->"09486f7c-2ca9-40e1-95a6-\
5c6f4ee5836b"]
}, Open  ]]
},
WindowSize->{1406, 751},
WindowMargins->{{171, Automatic}, {Automatic, 47}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
FrontEndVersion->"11.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 16, \
2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 922, 26, 77, "Text", "ExpressionUUID" -> \
"17bf2c7d-9fb8-44a6-87af-8a6134826c47"],
Cell[1483, 48, 2871, 59, 327, "Input", "ExpressionUUID" -> \
"bac99482-c875-4b5d-9494-2bd0b0e0ff7f"],
Cell[4357, 109, 6066, 144, 495, "Input", "ExpressionUUID" -> \
"609d29f7-0a0b-4f89-9d8a-cb6591f401a9"],
Cell[CellGroupData[{
Cell[10448, 257, 2849, 66, 285, "Input", "ExpressionUUID" -> \
"3b92c66c-7331-45bb-9f6e-cabb8f248a09"],
Cell[13300, 325, 935, 25, 49, "Output", "ExpressionUUID" -> \
"e4468b5b-b237-485a-aa19-934998878c6a"]
}, Open  ]],
Cell[14250, 353, 3430, 87, 285, "Input", "ExpressionUUID" -> \
"0e3fbda1-d99c-4dcd-a92c-41db55fa56c9"],
Cell[17683, 442, 147, 3, 54, "Input", "ExpressionUUID" -> \
"abcf8633-044c-4038-adc4-01dc171479fd"],
Cell[CellGroupData[{
Cell[17855, 449, 407, 10, 54, "Input", "ExpressionUUID" -> \
"a5eba7c4-4e30-4e9d-ba9d-6f18207e2324"],
Cell[18265, 461, 1306, 40, 49, "Output", "ExpressionUUID" -> \
"80d0818f-f0a8-432d-bab2-a1ca11444f86"]
}, Open  ]],
Cell[19586, 504, 5491, 148, 246, "Input", "ExpressionUUID" -> \
"f87970ff-fed9-4044-8315-7dbc78d2bc45"],
Cell[25080, 654, 4097, 95, 209, "Input", "ExpressionUUID" -> \
"268631f2-689b-4f0f-af2e-4e01db36ec74"],
Cell[CellGroupData[{
Cell[29202, 753, 516, 12, 54, "Input", "ExpressionUUID" -> \
"4cf51ded-f54e-41c5-a51b-999d65bfa352"],
Cell[29721, 767, 1336, 34, 35, "Output", "ExpressionUUID" -> \
"ce525556-a587-4c65-98d0-2c179a211e44"]
}, Open  ]],
Cell[31072, 804, 246, 4, 54, "Input", "ExpressionUUID" -> \
"b9cc74b1-3903-4a1b-b1bb-a5f943eba8e0"],
Cell[CellGroupData[{
Cell[31343, 812, 193, 4, 54, "Input", "ExpressionUUID" -> \
"a2b86ce6-ec0b-4e69-8037-97c65c7b1c6d"],
Cell[31539, 818, 1050, 30, 35, "Output", "ExpressionUUID" -> \
"0268bf0d-a4e2-44f4-8858-99e980a94d43"]
}, Open  ]],
Cell[CellGroupData[{
Cell[32626, 853, 398, 10, 54, "Input", "ExpressionUUID" -> \
"3271b799-feaf-47de-90a3-ef7e8f911dfd"],
Cell[33027, 865, 191, 3, 32, "Output", "ExpressionUUID" -> \
"09486f7c-2ca9-40e1-95a6-5c6f4ee5836b"]
}, Open  ]]
}
]
*)

